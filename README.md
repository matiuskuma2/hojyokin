# è£œåŠ©é‡‘ãƒ»åŠ©æˆé‡‘ è‡ªå‹•ãƒãƒƒãƒãƒ³ã‚°ï¼†ç”³è«‹æ›¸ä½œæˆæ”¯æ´ã‚·ã‚¹ãƒ†ãƒ  (ãƒ›ã‚¸ãƒ§ãƒ©ã‚¯)

## ğŸ“‹ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

- **Name**: subsidy-matching (hojyokin)
- **Version**: 1.4.8
- **Goal**: ä¼æ¥­æƒ…å ±ã‚’ç™»éŒ²ã™ã‚‹ã ã‘ã§ã€æœ€é©ãªè£œåŠ©é‡‘ãƒ»åŠ©æˆé‡‘ã‚’è‡ªå‹•ã§ãƒãƒƒãƒãƒ³ã‚°ï¼†ç”³è«‹æ›¸ãƒ‰ãƒ©ãƒ•ãƒˆä½œæˆ

### æœ€æ–°ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ (v1.4.8) - UI/UXæ”¹å–„ + JavaScriptä¿®æ­£

**æ©Ÿèƒ½æ”¹å–„ã¨ãƒã‚°ãƒ•ã‚£ãƒƒã‚¯ã‚¹:**

1. **JavaScript ã‚¹ã‚³ãƒ¼ãƒ—å•é¡Œã®ä¿®æ­£**
   - `searchSubsidies` ã¨ `setSearchMode` ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚³ãƒ¼ãƒ—ã«ç™»éŒ²
   - HTML `onclick` å±æ€§ã‹ã‚‰ã®é–¢æ•°å‘¼ã³å‡ºã—ã‚’ä¿®æ­£

2. **ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³é †åºã®å›ºå®šåŒ–**
   - ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ â†’ è£œåŠ©é‡‘ã‚’æ¢ã™ â†’ ä¼šç¤¾æƒ…å ± ã®é †åºã‚’å›ºå®š
   - ç¾åœ¨ã®ãƒšãƒ¼ã‚¸ã®ã¿ç·‘è‰²ï¼ˆä¸‹ç·šä»˜ãï¼‰ã§è¡¨ç¤º

3. **ä¸è¦ãªãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã®å‰Šé™¤**
   - ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‹ã‚‰ã®é·ç§»æ™‚ã®ã‚¢ãƒ©ãƒ¼ãƒˆã‚’å‰Šé™¤
   - ä¼šç¤¾æƒ…å ±ãƒã‚§ãƒƒã‚¯ã¯ `/subsidies` ãƒšãƒ¼ã‚¸å†…ã§å®Ÿæ–½

4. **ä¼šç¤¾APIä¿®æ­£**
   - `company_memberships` â†’ `user_companies` ãƒ†ãƒ¼ãƒ–ãƒ«ã«å¤‰æ›´
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ä¼šç¤¾ã®é–¢é€£ä»˜ã‘ã‚’æ­£ã—ãå–å¾—

### è¨­è¨ˆæ€æƒ³

> **ã€Œè£œåŠ©é‡‘ã‚’"é€šã™"ãƒ„ãƒ¼ãƒ«ã€ã§ã¯ãªãã€Œè£œåŠ©é‡‘ã§äººç”Ÿã‚’å£Šã•ã›ãªã„ãƒ„ãƒ¼ãƒ«ã€**

- æ¡æŠã‚ˆã‚Šå®Œèµ°
- é‡‘é¡ã‚ˆã‚Šå®‰å…¨
- è‡ªå‹•åŒ–ã‚ˆã‚Šåˆ¤æ–­è£œåŠ©

---

## ğŸŒ URLs

### æœ¬ç•ªç’°å¢ƒ (Cloudflare Pages)

| ãƒšãƒ¼ã‚¸ | URL | èª¬æ˜ |
|--------|-----|------|
| ãƒˆãƒƒãƒ— | https://hojyokin.pages.dev | ãƒ©ãƒ³ãƒ‡ã‚£ãƒ³ã‚° |
| ãƒ­ã‚°ã‚¤ãƒ³ | https://hojyokin.pages.dev/login | èªè¨¼ |
| æ–°è¦ç™»éŒ² | https://hojyokin.pages.dev/register | ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œæˆ |
| ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ | https://hojyokin.pages.dev/dashboard | ãƒ¡ã‚¤ãƒ³ç”»é¢ |
| ä¼šç¤¾æƒ…å ± | https://hojyokin.pages.dev/company | ä¼æ¥­ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç·¨é›† |
| è£œåŠ©é‡‘ä¸€è¦§ | https://hojyokin.pages.dev/subsidies | è£œåŠ©é‡‘æ¤œç´¢ |
| è£œåŠ©é‡‘è©³ç´° | https://hojyokin.pages.dev/subsidies/:id | å€‹åˆ¥è£œåŠ©é‡‘æƒ…å ± |
| å£æ‰“ã¡ãƒãƒ£ãƒƒãƒˆ | https://hojyokin.pages.dev/chat?session_id=XXX | S3: äº‹å‰åˆ¤å®šï¼‹ä¸è¶³æƒ…å ±åé›† |
| ç”³è«‹æ›¸ãƒ‰ãƒ©ãƒ•ãƒˆ | https://hojyokin.pages.dev/draft?session_id=XXX | S4: ç”³è«‹æ›¸ä½œæˆ |
| ç®¡ç†ç”»é¢ | https://hojyokin.pages.dev/admin | ç®¡ç†è€…ç”¨ |
| **é‹ç”¨ãƒã‚§ãƒƒã‚¯** | **https://hojyokin.pages.dev/admin/ops** | **30åˆ†æ¤œè¨¼ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆsuper_adminé™å®šï¼‰** |

### é–‹ç™ºç’°å¢ƒ

- **GitHub**: https://github.com/matiuskuma2/hojyokin
- **Sandbox**: PM2 + wrangler pages dev (port 3000)

### Cron/Consumer Workers

- **Cron Worker**: https://hojyokin-cron.sekiyadubai.workers.dev
  - `/cron/run?limitRegistry=200&limitLifecycle=50` - æ‰‹å‹•å®Ÿè¡Œ
- **Consumer Worker**: https://hojyokin-consumer.sekiyadubai.workers.dev
  - `/consumer/run?batch=10` - æ‰‹å‹•å®Ÿè¡Œ
  - `/consumer/stats` - ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª

---

## ğŸš€ æ–°ã—ã„ç’°å¢ƒã§ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

### 1. ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¯ãƒ­ãƒ¼ãƒ³

```bash
cd /home/user
git clone https://github.com/matiuskuma2/hojyokin.git webapp
cd webapp
```

### 2. ä¾å­˜é–¢ä¿‚ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
npm install
```

### 3. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š

`.dev.vars` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆï¼ˆæœ¬ç•ªã¯æ—¢ã«è¨­å®šæ¸ˆã¿ï¼‰:

```bash
cat > .dev.vars << 'EOF'
JWT_SECRET=your-secret-key-32-chars-minimum
JWT_ISSUER=subsidy-app
JWT_AUDIENCE=subsidy-app-users
JGRANTS_MODE=cached-only
FIRECRAWL_API_KEY=fc-xxx
EOF
```

### 4. D1ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®è¨­å®š

**ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã®å ´åˆ:**

```bash
# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é©ç”¨
npx wrangler d1 migrations apply subsidy-matching-production --local

# ã‚·ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿æŠ•å…¥ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
npx wrangler d1 execute subsidy-matching-production --local --file=./seed.sql
```

**æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤ã®å ´åˆ:**

```bash
# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³é©ç”¨
npx wrangler d1 migrations apply subsidy-matching-production

# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹IDã¯ wrangler.jsonc ã«è¨˜è¼‰:
# database_id: "e53f6185-60a6-45eb-b06d-c710ab3aef56"
```

### 5. ãƒ“ãƒ«ãƒ‰

```bash
npm run build
```

### 6. ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•

```bash
# PM2ã§èµ·å‹•ï¼ˆæ¨å¥¨ï¼‰
pm2 start ecosystem.config.cjs

# ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª
pm2 list

# ãƒ­ã‚°ç¢ºèª
pm2 logs webapp --nostream

# åœæ­¢
pm2 stop webapp
pm2 delete webapp
```

### 7. æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤

```bash
# Cloudflare API Keyã®è¨­å®šï¼ˆåˆå›ã®ã¿ï¼‰
# Deploy ã‚¿ãƒ–ã§ API Key ã‚’è¨­å®šã—ã¦ãã ã•ã„

# ãƒ‡ãƒ—ãƒ­ã‚¤å®Ÿè¡Œ
npm run deploy

# ã¾ãŸã¯ç›´æ¥
npx wrangler pages deploy dist --project-name hojyokin
```

### 8. Cron/Consumer Workers ã®ãƒ‡ãƒ—ãƒ­ã‚¤

```bash
# Cron Worker
cd /home/user/hojyokin-cron
npm install
npx wrangler deploy

# Consumer Worker
cd /home/user/hojyokin-consumer
npm install
npx wrangler deploy
```

---

## ğŸ“Š ãƒ‡ãƒ¼ã‚¿ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

### ä¸»è¦ãƒ†ãƒ¼ãƒ–ãƒ«

| ãƒ†ãƒ¼ãƒ–ãƒ« | èª¬æ˜ |
|----------|------|
| `users` | ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ |
| `companies` | ä¼šç¤¾åŸºæœ¬æƒ…å ± |
| `user_companies` | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ»ä¼šç¤¾é–¢é€£ä»˜ã‘ |
| `company_profile` | ä¼šç¤¾è©³ç´°ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ« |
| `company_documents` | ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ›¸é¡ |
| `subsidy_cache` | è£œåŠ©é‡‘ã‚­ãƒ£ãƒƒã‚·ãƒ¥ |
| `eligibility_rules` | é©æ ¼æ€§åˆ¤å®šãƒ«ãƒ¼ãƒ« |
| `chat_sessions` | å£æ‰“ã¡ã‚»ãƒƒã‚·ãƒ§ãƒ³ |
| `chat_messages` | ãƒãƒ£ãƒƒãƒˆå±¥æ­´ |
| `chat_facts` | åé›†æ¸ˆã¿äº‹å®Ÿ |
| `application_drafts` | ç”³è«‹æ›¸ãƒ‰ãƒ©ãƒ•ãƒˆ |
| `source_registry` | 47éƒ½é“åºœçœŒã‚¯ãƒ­ãƒ¼ãƒ«å°å¸³ |
| `crawl_queue` | Cronã‚­ãƒ¥ãƒ¼ |
| `domain_policy` | ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ–ãƒ­ãƒƒã‚¯ãƒãƒªã‚·ãƒ¼ |
| `usage_events` | åˆ©ç”¨ã‚¤ãƒ™ãƒ³ãƒˆï¼ˆKPIé›†è¨ˆç”¨ï¼‰ |

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šæƒ…å ±

- **D1 Database**: subsidy-matching-production
- **Database ID**: e53f6185-60a6-45eb-b06d-c710ab3aef56
- **R2 Bucket**: subsidy-knowledge

---

## ğŸ§ª å‹•ä½œç¢ºèª

### ãƒ†ã‚¹ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼

```bash
# ã‚¹ãƒ¼ãƒ‘ãƒ¼ã‚¢ãƒ‰ãƒŸãƒ³ãƒ¦ãƒ¼ã‚¶ãƒ¼
Email: matiuskuma2@gmail.com
User ID: 7e8ffc39-554e-4c28-ab89-9d3b9c0f68cd

# ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿
ä¼šç¤¾æ•°: 15ç¤¾ï¼ˆuser_companies ã«é–¢é€£ä»˜ã‘æ¸ˆã¿ï¼‰
- æ ªå¼ä¼šç¤¾ã‚¨ã‚¯ã‚¹ãƒšãƒªã‚¨ãƒ³ã‚¹
- ãƒ‡ãƒãƒƒã‚°æ ªå¼ä¼šç¤¾
- ãƒãƒ£ãƒƒãƒˆãƒ†ã‚¹ãƒˆæ ªå¼ä¼šç¤¾
ãªã©
```

### API ãƒ†ã‚¹ãƒˆ

```bash
# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
curl http://localhost:3000/api/health

# ãƒ­ã‚°ã‚¤ãƒ³
curl -X POST http://localhost:3000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"matiuskuma2@gmail.com","password":"your-password"}'

# ä¼šç¤¾ä¸€è¦§å–å¾—
curl http://localhost:3000/api/companies \
  -H "Authorization: Bearer YOUR_TOKEN"
```

### é‹ç”¨ç›£è¦–

```bash
# Cron æ‰‹å‹•å®Ÿè¡Œ
curl -s "https://hojyokin-cron.sekiyadubai.workers.dev/cron/run?limitRegistry=200&limitLifecycle=50"

# Consumer ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèª
curl -s "https://hojyokin-consumer.sekiyadubai.workers.dev/consumer/stats"

# ã‚­ãƒ¥ãƒ¼çŠ¶æ…‹ç¢ºèª
npx wrangler d1 execute subsidy-matching-production --remote \
  --command="SELECT status, COUNT(*) cnt FROM crawl_queue GROUP BY status;"
```

---

## ğŸ”§ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ä¼šç¤¾ãŒè¡¨ç¤ºã•ã‚Œãªã„

**åŸå› **: `user_companies` ãƒ†ãƒ¼ãƒ–ãƒ«ã®é–¢é€£ä»˜ã‘ãŒä¸è¶³

**è§£æ±ºç­–**:

```bash
# ãƒ¦ãƒ¼ã‚¶ãƒ¼IDã‚’ç¢ºèª
npx wrangler d1 execute subsidy-matching-production --remote \
  --command="SELECT id, email FROM users WHERE email='your-email@example.com';"

# ä¼šç¤¾IDã‚’ç¢ºèª
npx wrangler d1 execute subsidy-matching-production --remote \
  --command="SELECT id, name FROM companies LIMIT 10;"

# é–¢é€£ä»˜ã‘ã‚’è¿½åŠ 
npx wrangler d1 execute subsidy-matching-production --remote \
  --command="INSERT INTO user_companies (id, user_id, company_id, created_at)
SELECT lower(hex(randomblob(4)) || '-' || hex(randomblob(2)) || '-' || hex(randomblob(2)) || '-' || hex(randomblob(2)) || '-' || hex(randomblob(6))),
       'YOUR_USER_ID',
       id,
       datetime('now')
FROM companies
WHERE id NOT IN (SELECT company_id FROM user_companies WHERE user_id='YOUR_USER_ID');"
```

### Consumer ãŒå‹•ã‹ãªã„

**åŸå› **: Firecrawl API ã® timeout ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãŒå°ã•ã™ãã‚‹

**è§£æ±ºç­–**: hojyokin-consumer ã® `src/index.ts` ã§ `timeout: timeoutMs` ï¼ˆãƒŸãƒªç§’ï¼‰ã«ä¿®æ­£æ¸ˆã¿

### ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼

**åŸå› **: Node.js ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¾ãŸã¯ä¾å­˜é–¢ä¿‚ã®å•é¡Œ

**è§£æ±ºç­–**:

```bash
# Node.js ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèªï¼ˆv18ä»¥ä¸Šæ¨å¥¨ï¼‰
node -v

# node_modules ã‚’å‰Šé™¤ã—ã¦å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
rm -rf node_modules package-lock.json
npm install

# ãƒ“ãƒ«ãƒ‰
npm run build
```

---

## ğŸ“ é–‹ç™ºã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

### ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¦å‰‡

1. **APIå‘¼ã³å‡ºã—ã¯ `window.api()` ã‚’ä½¿ç”¨**
   - èªè¨¼ãƒˆãƒ¼ã‚¯ãƒ³ã¯è‡ªå‹•ä»˜ä¸
   - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¯å…±é€šé–¢æ•°å†…ã§å®Ÿæ–½

2. **DOMæ“ä½œã¯å¿…ãšnullãƒã‚§ãƒƒã‚¯**
   ```javascript
   var el = document.getElementById('user-name');
   if (el) {
     el.textContent = user.name || '';
   }
   ```

3. **ES5äº’æ›æ€§ã‚’ç¶­æŒ**
   - `var` ã‚’ä½¿ç”¨ï¼ˆ`let`/`const` ã¯é¿ã‘ã‚‹ï¼‰
   - ã‚¢ãƒ­ãƒ¼é–¢æ•°ã¯ä½¿ã‚ãš `function` ã‚’ä½¿ç”¨

4. **ã‚°ãƒ­ãƒ¼ãƒãƒ«é–¢æ•°ã¯ `window` ã«ç™»éŒ²**
   ```javascript
   window.searchSubsidies = async function(page = 1) {
     // ...
   };
   ```

### Git ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

```bash
# å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆ
git add .
git commit -m "èª¬æ˜çš„ãªã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸"

# GitHub ã«ãƒ—ãƒƒã‚·ãƒ¥
git push origin main

# ãƒ‡ãƒ—ãƒ­ã‚¤
npm run deploy
```

---

## ğŸ—‚ï¸ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
webapp/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.tsx              # ãƒ¡ã‚¤ãƒ³ã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”‚   â”œâ”€â”€ routes/                # API ãƒ«ãƒ¼ãƒˆ
â”‚   â”‚   â”œâ”€â”€ auth.ts            # èªè¨¼ API
â”‚   â”‚   â”œâ”€â”€ companies.ts       # ä¼šç¤¾ API
â”‚   â”‚   â”œâ”€â”€ subsidies.ts       # è£œåŠ©é‡‘ API
â”‚   â”‚   â”œâ”€â”€ chat.ts            # ãƒãƒ£ãƒƒãƒˆ API
â”‚   â”‚   â”œâ”€â”€ draft.ts           # ãƒ‰ãƒ©ãƒ•ãƒˆ API
â”‚   â”‚   â”œâ”€â”€ agency.ts          # Agency API
â”‚   â”‚   â””â”€â”€ admin-dashboard.ts # ç®¡ç† API
â”‚   â”œâ”€â”€ pages/                 # UI ãƒšãƒ¼ã‚¸
â”‚   â”‚   â”œâ”€â”€ auth.tsx           # èªè¨¼ãƒšãƒ¼ã‚¸
â”‚   â”‚   â”œâ”€â”€ dashboard.tsx      # ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
â”‚   â”‚   â”œâ”€â”€ company.tsx        # ä¼šç¤¾æƒ…å ±
â”‚   â”‚   â”œâ”€â”€ subsidies.tsx      # è£œåŠ©é‡‘æ¤œç´¢
â”‚   â”‚   â”œâ”€â”€ chat.tsx           # å£æ‰“ã¡ãƒãƒ£ãƒƒãƒˆ
â”‚   â”‚   â”œâ”€â”€ draft.tsx          # ç”³è«‹æ›¸ãƒ‰ãƒ©ãƒ•ãƒˆ
â”‚   â”‚   â”œâ”€â”€ agency.tsx         # Agencyç®¡ç†
â”‚   â”‚   â””â”€â”€ admin.tsx          # ç®¡ç†ç”»é¢
â”‚   â”œâ”€â”€ lib/                   # ãƒ©ã‚¤ãƒ–ãƒ©ãƒª
â”‚   â”‚   â”œâ”€â”€ auth.ts            # èªè¨¼ãƒ˜ãƒ«ãƒ‘ãƒ¼
â”‚   â”‚   â”œâ”€â”€ jgrants-adapter.ts # JGrantsé€£æº
â”‚   â”‚   â””â”€â”€ usage-tracker.ts   # åˆ©ç”¨ã‚¤ãƒ™ãƒ³ãƒˆè¨˜éŒ²
â”‚   â””â”€â”€ types/                 # TypeScriptå‹å®šç¾©
â”œâ”€â”€ public/                    # é™çš„ãƒ•ã‚¡ã‚¤ãƒ«
â”‚   â”œâ”€â”€ static/                # CSS/JS
â”‚   â”‚   â”œâ”€â”€ app.js
â”‚   â”‚   â””â”€â”€ styles.css
â”‚   â”œâ”€â”€ favicon.png
â”‚   â”œâ”€â”€ manifest.json          # PWA ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆ
â”‚   â””â”€â”€ sw.js                  # Service Worker
â”œâ”€â”€ migrations/                # D1 ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â”œâ”€â”€ 0001_initial_schema.sql
â”‚   â”œâ”€â”€ 0002_eligibility_rules.sql
â”‚   â””â”€â”€ ...
â”œâ”€â”€ ecosystem.config.cjs       # PM2 è¨­å®š
â”œâ”€â”€ wrangler.jsonc             # Cloudflare è¨­å®š
â”œâ”€â”€ vite.config.ts             # Vite è¨­å®š
â”œâ”€â”€ package.json               # ä¾å­˜é–¢ä¿‚
â””â”€â”€ README.md                  # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
```

---

## ğŸ“ˆ å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½

- [x] èªè¨¼ (JWT + PBKDF2)
- [x] ä¼æ¥­CRUD + ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ç®¡ç†
- [x] è£œåŠ©é‡‘æ¤œç´¢ï¼ˆJGrants APIé€£æºï¼‰
- [x] 47éƒ½é“åºœçœŒã‚¯ãƒ­ãƒ¼ãƒ«å°å¸³
- [x] S3: å£æ‰“ã¡ãƒãƒ£ãƒƒãƒˆï¼ˆäº‹å‰åˆ¤å®š + ä¸è¶³æƒ…å ±åé›†ï¼‰
- [x] S4: ç”³è«‹æ›¸ãƒ‰ãƒ©ãƒ•ãƒˆç”Ÿæˆï¼ˆãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ + NGãƒã‚§ãƒƒã‚¯ï¼‰
- [x] Agencyæ©Ÿèƒ½ï¼ˆå£«æ¥­å‘ã‘é¡§å®¢ç®¡ç†ï¼‰
- [x] é‹ç”¨ç›£è¦–ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ï¼ˆ/admin/opsï¼‰
- [x] PWAå¯¾å¿œï¼ˆService Worker + Manifestï¼‰
- [x] æ›¸é¡ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ï¼ˆPDF.jsæŠ½å‡ºï¼‰

---

## ğŸ“‹ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### å„ªå…ˆåº¦: é«˜

1. **ä¼šç¤¾é¸æŠãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã®è¡¨ç¤ºç¢ºèª**
   - API `/api/companies` ã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ç¢ºèª
   - `user_companies` ãƒ†ãƒ¼ãƒ–ãƒ«ã®é–¢é€£ä»˜ã‘ç¢ºèª

2. **Consumer ã®å®‰å®šç¨¼åƒ**
   - Firecrawl ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã®ç›£è¦–
   - ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ–ãƒ­ãƒƒã‚¯ã®é©åˆ‡ãªè¨­å®š

3. **L2 å®Ÿç¨¼åƒã®ç·‘åŒ–**
   - ç›´è¿‘24æ™‚é–“ã® done/failed ã‚«ã‚¦ãƒ³ãƒˆå¢—åŠ 
   - Prefecture ã®å®šæœŸã‚¯ãƒ­ãƒ¼ãƒ«ç¢ºèª

### å„ªå…ˆåº¦: ä¸­

1. **KPI å‹•ä½œç¢ºèª**
   - SUBSIDY_SEARCH ã‚¤ãƒ™ãƒ³ãƒˆã®è¨˜éŒ²
   - CHAT_SESSION_STARTED ã‚¤ãƒ™ãƒ³ãƒˆã®è¨˜éŒ²
   - DRAFT_GENERATED ã‚¤ãƒ™ãƒ³ãƒˆã®è¨˜éŒ²

2. **UI/UX æ”¹å–„**
   - ãƒ¢ãƒã‚¤ãƒ«å¯¾å¿œã®å¼·åŒ–
   - ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£å‘ä¸Š

---

## ğŸ“„ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

Private

---

## ğŸ”„ æ›´æ–°å±¥æ­´

- **2026-01-23 (v1.4.8)**: UI/UXæ”¹å–„: JavaScriptã‚¹ã‚³ãƒ¼ãƒ—å•é¡Œä¿®æ­£ã€ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³é †åºå›ºå®šã€ä¸è¦ãªãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—å‰Šé™¤ã€ä¼šç¤¾APIä¿®æ­£
- **2026-01-22 (v1.4.7)**: JavaScriptã‚¹ã‚³ãƒ¼ãƒ—å•é¡Œã®ä¿®æ­£ï¼ˆsearchSubsidies, setSearchMode ã‚’ã‚°ãƒ­ãƒ¼ãƒãƒ«åŒ–ï¼‰ã€ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³å‹•çš„ã‚¹ã‚¿ã‚¤ãƒ«å®Ÿè£…
- **2026-01-22 (v1.4.6)**: ä¼šç¤¾APIä¿®æ­£ï¼ˆcompany_memberships â†’ user_companiesï¼‰ã€ä¼šç¤¾é¸æŠãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã®è¡¨ç¤ºä¿®æ­£
- **2026-01-22 (v1.4.5)**: è£œåŠ©é‡‘æ¤œç´¢ãƒšãƒ¼ã‚¸ã®UI/UXæ”¹å–„ï¼ˆç™»éŒ²çŠ¶æ³ã«å¿œã˜ãŸè¡¨ç¤ºã€api is not defined ã‚¨ãƒ©ãƒ¼ä¿®æ­£ï¼‰
- **2026-01-22 (v1.4.4)**: A-1å°å¸³æƒã„ã®é›†è¨ˆãƒ­ã‚¸ãƒƒã‚¯ä¿®æ­£ï¼ˆregistry_counts è¿½åŠ ï¼‰ã€é€²æ—è¡¨ç¤ºUIå®Ÿè£…
- **2026-01-22 (v1.4.3)**: PWAå¯¾å¿œå®Œäº†ã€é‹ç”¨ãƒã‚§ãƒƒã‚¯ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰è¿½åŠ 
- **2026-01-22 (v1.4.2)**: é‹ç”¨ç›£è¦–å¼·åŒ–ã€usage_eventsè¨˜éŒ²å¼·åŒ–
- **2026-01-22**: S3/S4å®Ÿè£…å®Œäº†ã€Agencyæ©Ÿèƒ½è¿½åŠ ã€Superadmin KPIå®Ÿè£…
