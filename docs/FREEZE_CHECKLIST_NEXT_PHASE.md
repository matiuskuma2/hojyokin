# å‡çµãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆï¼ˆæ¬¡ãƒ•ã‚§ãƒ¼ã‚ºï¼‰

**ä½œæˆæ—¥**: 2026-01-24  
**ç›®çš„**: ã€Œä¸­é€”åŠç«¯ã«å´©ã‚Œãªã„ã€ãŸã‚ã®å‡çµæ¡ä»¶ã¨åˆæ ¼åŸºæº–

---

## P0: æœ€å„ªå…ˆï¼ˆæœ¬ç•ªå½±éŸ¿ã‚ã‚Šï¼‰

### P0-1: Agencyæ¤œç´¢UIã‚’Userç‰ˆã«å¯„ã›ã‚‹ âœ… ã»ã¼å®Œäº†

**ç›®çš„**: Agencyå´ã® `/agency/search` ã‚’ã€Œåˆ¥ç‰©UIã€ã«ã—ãªã„

**ç¾çŠ¶**: 
- ãƒ•ã‚£ãƒ«ã‚¿æ§‹é€ : âœ… çµ±ä¸€æ¸ˆã¿
- çµæœã‚«ãƒ¼ãƒ‰: âœ… çµ±ä¸€æ¸ˆã¿  
- æ¤œç´¢ãƒ¢ãƒ¼ãƒ‰: âœ… çµ±ä¸€æ¸ˆã¿
- JSé–¢æ•°å®šç¾©: âœ… window.setSearchMode, window.searchSubsidies å®šç¾©æ¸ˆã¿

**æ®‹ã‚¿ã‚¹ã‚¯**:
- [ ] APIå‘¼ã³å‡ºã—é–¢æ•°åã®çµ±ä¸€æ¤œè¨ï¼ˆ`window.api` vs `window.apiCall`ï¼‰
- [ ] ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ç ´ç¶»ãƒ†ã‚¹ãƒˆï¼ˆç·‘ãƒ˜ãƒƒãƒ€ãƒ¼å†…ã§å®Œçµç¢ºèªï¼‰

**åˆæ ¼æ¡ä»¶**:
- [ ] Agencyã§ã€Œè£œåŠ©é‡‘æ¤œç´¢ã€â†’ æ¤œç´¢å¾Œã‚‚æˆ»ã‚‹/ãƒŠãƒ“ãŒç ´ç¶»ã—ãªã„
- [ ] "ãƒ•ã‚£ãƒ«ã‚¿UI"ã¨"çµæœã®èª¬æ˜"ãŒUserç‰ˆã¨åŒä¸€
- [ ] JSã‚¨ãƒ©ãƒ¼ã‚¼ãƒ­ï¼ˆapi is not defined / setSearchMode is not defined å†ç™ºã‚¼ãƒ­ï¼‰

**ç¦æ­¢**:
- "Agencyã ã‘ç°¡æ˜“UI"ã®ã¾ã¾æ”¾ç½®
- /subsidies ã«é·ç§»ã•ã›ã¦æˆ»ã‚Œãªããªã‚‹å°ç·š

---

### P0-2: ä¼šç¤¾ç™»éŒ²ã€Œå¤±æ•—ã‚¼ãƒ­ã€ãƒ«ãƒ¼ãƒ«å‡çµ âœ… å®Œäº†

**ç›®çš„**: ä¼šç¤¾æƒ…å ±ç™»éŒ²ã®å¤±æ•—ã€å¿…é ˆé …ç›®æƒã£ã¦ã„ã‚‹ã®ã«æ¤œç´¢ä¸å¯ã‚’ã‚¼ãƒ­ã«ã™ã‚‹

**å‡çµä»•æ§˜ï¼ˆç¢ºå®šï¼‰**:
- å¿…é ˆ: ä¼šç¤¾å / éƒ½é“åºœçœŒ / æ¥­ç¨® / å¾“æ¥­å“¡æ•°ï¼ˆæ•°å€¤ > 0ï¼‰
- `GET /api/companies/:id/completeness` ã‚’å”¯ä¸€ã®çœŸå®Ÿã¨ã—ã¦ä½¿ç”¨
- status: `BLOCKED` â†’ æ¤œç´¢ä¸å¯ã€`NEEDS_RECOMMENDED` â†’ æ¤œç´¢å¯ï¼ˆæ¨å¥¨ä¸è¶³ï¼‰ã€`OK` â†’ æ¤œç´¢å¯ï¼ˆå®Œäº†ï¼‰

**å®Ÿè£…å®Œäº†ï¼ˆ2026-01-24ï¼‰**:
- [x] completeness API: âœ… å‡çµä»•æ§˜é€šã‚Šå®Ÿè£…æ¸ˆã¿
- [x] POST /api/companies: âœ… ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åˆ¥ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³è¿½åŠ 
- [x] PUT /api/companies/:id: âœ… ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åˆ¥ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³è¿½åŠ 
- [x] POST /api/agency/submissions/:id/approve: âœ… intakeæ‰¿èªæ™‚ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³è¿½åŠ 
- [x] /intake ãƒ•ã‚©ãƒ¼ãƒ : âœ… å¿…é ˆ4é …ç›®ã‚’requiredæŒ‡å®šã€æ•°å€¤ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’æ•°å€¤å‹ã«å¤‰æ›

**ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ«ãƒ¼ãƒ«**:
- `name`: æ–‡å­—åˆ—ã€trimå¾Œéç©º
- `prefecture`: æ–‡å­—åˆ—ã€trimå¾Œéç©º
- `industry_major`: æ–‡å­—åˆ—ã€trimå¾Œéç©º
- `employee_count`: æ•°å€¤ã€> 0
- `capital`: æ•°å€¤ã€>= 0ï¼ˆä»»æ„é …ç›®ï¼‰
- `annual_revenue`: æ•°å€¤ã€>= 0ï¼ˆä»»æ„é …ç›®ï¼‰

**ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹å½¢å¼**:
```json
{
  "success": false,
  "error": {
    "code": "VALIDATION_ERROR",
    "message": "Validation failed",
    "fields": {
      "employee_count": "å¾“æ¥­å“¡æ•°ã¯1ä»¥ä¸Šã®æ•°å€¤ã§å…¥åŠ›ã—ã¦ãã ã•ã„"
    }
  }
}
```

**åˆæ ¼æ¡ä»¶**:
- [x] ä¼šç¤¾ç™»éŒ²â†’å³completenessåæ˜ â†’æ¤œç´¢å¯å¦ãŒ100%ä¸€è‡´
- [x] User / Agencyä»£è¡Œå…¥åŠ› / é¡§å®¢ãƒªãƒ³ã‚¯å…¥åŠ› ã®3çµŒè·¯ã§åŒã˜æŒ™å‹•
- [x] å¤±æ•—æ™‚ã¯ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰åˆ¥ã‚¨ãƒ©ãƒ¼ã‚’è¿”ã™

---

### P0-3: Agencyãƒªãƒ³ã‚¯ç®¡ç†ã®æ„å‘³ã‚’å‡çµ âœ… å®Ÿè£…ç¢ºèªæ¸ˆã¿

**ç›®çš„**: ã€Œãƒªãƒ³ã‚¯ç®¡ç†ãŒä½•ã®ãŸã‚ã«ã‚ã‚‹ã‹ä¸æ˜ã€ã¨ã„ã†çŠ¶æ…‹ã‚’è§£æ¶ˆ

**å‡çµä»•æ§˜**:
- access_links ãƒ†ãƒ¼ãƒ–ãƒ«: é¡§å®¢ã®ä¼šç¤¾æƒ…å ±å…¥åŠ›ã‚’ä¾é ¼ã™ã‚‹å°ç·š
- çŠ¶æ…‹é·ç§»: ç™ºè¡Œ â†’ æœªä½¿ç”¨ â†’ æå‡º â†’ æ‰¿èª/å´ä¸‹ â†’ ï¼ˆæ‰¿èªå¾Œã¯company/profileåæ˜ ï¼‰
- æ‰¿èªæ¸ˆã¿ã®ä¼šç¤¾ã¯ `/agency/clients/:id` ã§å¿…ãšè¦‹ã‚Œã‚‹

**å®Ÿè£…ç¢ºèªï¼ˆ2026-01-24ï¼‰**:

**P0-3-1: ãƒªãƒ³ã‚¯ç®¡ç†ã«ã€Œç™ºè¡Œã—ãŸãƒªãƒ³ã‚¯ãŒå¿…ãšå‡ºã‚‹ã€**
- [x] GET /api/agency/links: access_linksä¸€è¦§å–å¾—å®Ÿè£…æ¸ˆã¿
- [x] POST /api/agency/links: ãƒªãƒ³ã‚¯ç™ºè¡Œå®Ÿè£…æ¸ˆã¿
- [x] DELETE /api/agency/links/:id: ãƒªãƒ³ã‚¯ç„¡åŠ¹åŒ–å®Ÿè£…æ¸ˆã¿
- [x] UI: /agency/links ã§ã‚¿ã‚¤ãƒ—ãƒ•ã‚£ãƒ«ã‚¿ã€æœ‰åŠ¹ã®ã¿è¡¨ç¤ºå¯¾å¿œ
- [x] UI: ç™ºè¡Œå®Œäº†ãƒ¢ãƒ¼ãƒ€ãƒ«ã§URLã‚³ãƒ”ãƒ¼æ©Ÿèƒ½ã‚ã‚Š

**P0-3-2: æ‰¿èªå¾Œã®é¡§å®¢è©³ç´°ãŒå¿…ãšé–‹ã**
- [x] GET /api/agency/clients/:id: é¡§å®¢è©³ç´° + é–¢é€£ãƒ‡ãƒ¼ã‚¿å–å¾—
- [x] links, submissions, drafts, sessions ã‚’ä¸€æ‹¬å–å¾—
- [x] UI: /agency/clients/:id ã§4ã‚¿ãƒ–è¡¨ç¤ºï¼ˆä¼æ¥­æƒ…å ±/å…¥åŠ›å±¥æ­´/ãƒ‰ãƒ©ãƒ•ãƒˆ/ãƒªãƒ³ã‚¯ï¼‰

**P0-3-3: çŠ¶æ…‹é·ç§»ã®å‡çµ**
- [x] intake_submissions: submitted â†’ approved/rejected
- [x] POST /api/agency/submissions/:id/approve: ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãæ‰¿èª
- [x] POST /api/agency/submissions/:id/reject: å´ä¸‹ç†ç”±ä»˜ã
- [x] æ‰¿èªæ™‚: companies, company_profile ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ›´æ–°

**UI/APIå¯¾å¿œè¡¨**:
| ç”»é¢ | API | ç¢ºèªçŠ¶æ…‹ |
|------|-----|----------|
| /agency/links | GET /api/agency/links | âœ… |
| /agency/links ç™ºè¡Œ | POST /api/agency/links | âœ… |
| /agency/submissions | GET /api/agency/submissions | âœ… |
| /agency/submissions æ‰¿èª | POST /api/agency/submissions/:id/approve | âœ… |
| /agency/clients/:id | GET /api/agency/clients/:id | âœ… |

---

## P1: å„ªå…ˆåº¦ä¸­ï¼ˆUXå‘ä¸Šï¼‰

### P1-1: Feedã‚«ãƒ†ã‚´ãƒªæ çµ„ã¿å›ºå®š âœ… å®Œäº†

**å‡çµä»•æ§˜**:
- `platform`: ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ãŠçŸ¥ã‚‰ã›
- `support_info`: æ–°ç€æ”¯æ´æƒ…å ±
- `prefecture`: éƒ½é“åºœçœŒNEWS
- `municipal`: å¸‚åŒºç”ºæ‘NEWS
- `ministry`: çœåºNEWS
- `other_public`: ãã®ä»–å…¬çš„æ©Ÿé–¢

**source_type CHECKåˆ¶ç´„**:
```sql
source_type IN ('platform','support_info','prefecture','municipal','ministry','other_public')
```

---

### P1-2: é¡§å®¢æ‰€åœ¨åœ°é€£å‹•NEWSå„ªå…ˆ ğŸ”´ æœªç€æ‰‹

**ä»•æ§˜**:
- é¡§å®¢ï¼ˆagency_clients â†’ companies.prefectureï¼‰ã®æ‰€åœ¨åœ°ã‚’å–å¾—
- `prefecture_code` ä¸€è‡´ã®NEWSã‚’ä¸Šä½è¡¨ç¤º

**å®Ÿè£…ç®‡æ‰€**: `/api/agency/dashboard-v2` ã¾ãŸã¯ `public-news`

---

### P1-3: ãŠã™ã™ã‚ã‚µã‚¸ã‚§ã‚¹ãƒˆ ğŸ”´ æœªç€æ‰‹

**ä»•æ§˜**:
- 1st: ãƒ«ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ï¼ˆåœ°åŸŸä¸€è‡´ï¼‹æ¥­ç¨®ä¸€è‡´ï¼‹å¾“æ¥­å“¡è¦æ¨¡å¸¯ï¼‰
- 2nd: ä¸Šä½å€™è£œã ã‘LLMã§ç†ç”±ç”Ÿæˆï¼ˆã‚³ã‚¹ãƒˆæŠ‘åˆ¶ï¼‰

---

## å®Ÿè£…å„ªå…ˆé †åºï¼ˆæ›´æ–°: 2026-01-24ï¼‰

1. ~~**P0-2**: POST/PUTãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å¼·åŒ–~~ âœ… å®Œäº†
2. ~~**P0-3**: ãƒªãƒ³ã‚¯ç®¡ç†ã®çŠ¶æ…‹é·ç§»ç¢ºèª~~ âœ… å®Ÿè£…ç¢ºèªæ¸ˆã¿
3. **P0-1**: ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ç ´ç¶»ãƒ†ã‚¹ãƒˆï¼ˆè»½å¾®ï¼‰ â†’ æ¬¡å›å®Ÿæ–½
4. **P1-2**: é¡§å®¢æ‰€åœ¨åœ°é€£å‹•NEWS â†’ æ¬¡å›ç€æ‰‹
5. **P1-3**: ãŠã™ã™ã‚ã‚µã‚¸ã‚§ã‚¹ãƒˆ

---

## ç¦æ­¢äº‹é …ï¼ˆå…¨ãƒ•ã‚§ãƒ¼ã‚ºå…±é€šï¼‰

1. UIå´ç‹¬è‡ªã®å¿…é ˆåˆ¤å®šã‚’ç¦æ­¢ â†’ completeness API ã‚’å”¯ä¸€ã®çœŸå®Ÿã¨ã™ã‚‹
2. Agencyã‹ã‚‰ /subsidies ã¸ã®ç›´æ¥é·ç§»ã‚’ç¦æ­¢ â†’ ç·‘ãƒ˜ãƒƒãƒ€ãƒ¼å†…ã§å®Œçµ
3. source_type ã®è¨±å®¹å€¤å¤–ã‚’ DB ã«å…¥ã‚Œãªã„ â†’ CHECKåˆ¶ç´„ã§é˜²æ­¢æ¸ˆã¿
4. employee_count <= 0 ã‚’è¨±å¯ã—ãªã„ â†’ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã§é˜²æ­¢
