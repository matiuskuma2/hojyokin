# コスト概算テンプレート

## 単価表（2026年1月時点）

### Firecrawl
| プラン | 単価 | 備考 |
|-------|------|------|
| Free | $0/月 | 500クレジット/月 |
| Hobby | $16/月 | 3,000クレジット/月 |
| Standard | $80/月 | 100,000クレジット/月 |
| Growth | $330/月 | 500,000クレジット/月 |

**1クレジット = 1ページ（HTMLまたはPDF 1ファイル）**

### OpenAI（GPT-4o-mini）
| 用途 | Input | Output | 概算 |
|------|-------|--------|------|
| 構造化抽出 | $0.15/1M tokens | $0.60/1M tokens | ~$0.001/件 |
| 壁打ちチャット | $0.15/1M tokens | $0.60/1M tokens | ~$0.01/セッション |
| ドラフト生成 | $0.15/1M tokens | $0.60/1M tokens | ~$0.05/件 |

### AWS（将来用）
| サービス | 単価 | 備考 |
|---------|------|------|
| Textract（OCR） | $1.50/1,000ページ | スキャンPDF用 |
| Lambda | $0.20/1M リクエスト | 実行時間による |

---

## 週次コスト概算フォーム

### Step 1: クロール量を入力
| 項目 | 今週の想定 | 単価 | コスト |
|------|----------|------|--------|
| ページ数（HTML） | `____` pages | $0.005 | $`____` |
| PDF数（テキスト） | `____` files | $0.00 | $0.00 |
| PDF数（OCR必要） | `____` files | $0.0015 | $`____` |
| **Firecrawl小計** | | | $`____` |

### Step 2: AI処理量を入力
| 項目 | 今週の想定 | 単価 | コスト |
|------|----------|------|--------|
| 構造化抽出 | `____` 件 | $0.001 | $`____` |
| 壁打ちセッション | `____` 件 | $0.01 | $`____` |
| ドラフト生成 | `____` 件 | $0.05 | $`____` |
| **OpenAI小計** | | | $`____` |

### Step 3: 合計
| 項目 | 週次 | 月次（×4.3） |
|------|------|-------------|
| Firecrawl | $`____` | $`____` |
| OpenAI | $`____` | $`____` |
| **合計** | $`____` | $`____` |

---

## シナリオ別コスト試算

### シナリオ A: 最小運用（試験段階）
- 対象: priority=1 のみ（21ソース）
- 頻度: 週1回
- 深さ: max_depth=1

| 項目 | 数量 | コスト |
|------|------|--------|
| HTMLページ | 100 | $0.50 |
| PDF（テキスト） | 50 | $0.00 |
| 構造化抽出 | 50 | $0.05 |
| **週次合計** | | **$0.55** |
| **月次合計** | | **$2.37** |

### シナリオ B: 標準運用
- 対象: 全65ソース
- 頻度: priority=1は日次、他は週次
- 深さ: max_depth=2

| 項目 | 数量 | コスト |
|------|------|--------|
| HTMLページ | 800 | $4.00 |
| PDF（テキスト） | 200 | $0.00 |
| 構造化抽出 | 200 | $0.20 |
| **週次合計** | | **$4.20** |
| **月次合計** | | **$18.06** |

### シナリオ C: フル運用（OCR含む）
- 対象: 全65ソース + スキャンPDF
- 頻度: priority=1は日次、他は週次
- 深さ: max_depth=2
- OCR: スキャンPDF 100件/月

| 項目 | 数量 | コスト |
|------|------|--------|
| HTMLページ | 800 | $4.00 |
| PDF（テキスト） | 200 | $0.00 |
| PDF（OCR） | 25/週 | $0.04 |
| 構造化抽出 | 250 | $0.25 |
| **週次合計** | | **$4.29** |
| **月次合計** | | **$18.45** |

---

## ユーザーアクション別コスト

### 補助金検索（S1）
| 項目 | コスト |
|------|--------|
| Jグランツ API | $0.00（無料） |
| D1クエリ | $0.00（無料枠内） |
| **合計** | **$0.00/検索** |

### 壁打ちチャット（S3）
| 項目 | コスト |
|------|--------|
| GPT-4o-mini（平均5ターン） | ~$0.01 |
| **合計** | **$0.01/セッション** |

### ドラフト生成（S4）
| 項目 | コスト |
|------|--------|
| GPT-4o-mini（セクション生成） | ~$0.03 |
| GPT-4o-mini（NGチェック） | ~$0.02 |
| **合計** | **$0.05/件** |

---

## 無駄コスト検知指標

### 1. ドメイン別エラー率
```sql
-- エラー率 50% 以上のドメインは無駄コスト
SELECT domain_key, failure_count, success_count,
  ROUND(100.0 * failure_count / (failure_count + success_count), 2) as error_rate
FROM domain_policy
WHERE failure_count + success_count > 10
  AND failure_count > success_count
ORDER BY error_rate DESC;
```

### 2. 重複クロール検知
```sql
-- 同じURLを5回以上叩いているケース
SELECT url, COUNT(*) as cnt
FROM crawl_queue
WHERE created_at >= datetime('now', '-7 days')
GROUP BY url
HAVING cnt >= 5;
```

### 3. blocked ドメインへの無駄リクエスト
```sql
-- blocked なのにキューに入っているもの
SELECT cq.url, dp.blocked_reason
FROM crawl_queue cq
JOIN domain_policy dp ON cq.domain_key = dp.domain_key
WHERE dp.blocked_until > datetime('now')
  AND cq.status = 'queued';
```

---

## 月次コストレポートテンプレート

```
## 月次コストレポート（YYYY年MM月）

### サマリー
- 総コスト: $XX.XX
- 前月比: +XX% / -XX%
- 予算内: ✅ / ⚠️ / ❌

### 内訳
| 項目 | コスト | 前月 | 増減 |
|------|--------|------|------|
| Firecrawl | $XX.XX | $XX.XX | +XX% |
| OpenAI | $XX.XX | $XX.XX | +XX% |
| AWS | $XX.XX | $XX.XX | +XX% |
| **合計** | $XX.XX | $XX.XX | +XX% |

### 無駄コスト検知
- エラー率50%超ドメイン: XX件
- 重複クロール: XX件
- 推定無駄コスト: $XX.XX

### 来月の見通し
- 予定クロール量: XXページ
- 予定PDF処理: XX件
- 予想コスト: $XX.XX

### コスト最適化アクション
1. [ドメイン名] のクロール停止（月$X.XX削減）
2. ...
```

---

## アラート閾値

| 指標 | 警告 | 危険 |
|------|------|------|
| 日次コスト | $5以上 | $10以上 |
| 週次コスト | $20以上 | $50以上 |
| 月次コスト | $100以上 | $200以上 |
| 前日比 | 2倍以上 | 3倍以上 |
| エラー率 | 30%以上 | 50%以上 |
